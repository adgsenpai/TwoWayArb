<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ADGSTUDIOS | Arbitrage Profitability Calculator</title>
  <meta name="description" content="Calculate two-way, matrix, and multi-match arbitrage opportunities with detailed profit margins, currency conversion, Excel upload, and complete mathematical proofs. Check your arbitrage profits with our advanced interactive calculator." />
  <meta name="keywords" content="arbitrage, calculator, profit margin, currency, sports betting arbitrage, matrix arbitrage, multi-match arbitrage, Excel upload, sample Excel, lemma, theorem, math derivation, SEO" />
  <link rel="icon" type="image/x-icon" href="/static/1-59db940c.ico">
  <link href="https://cdn.tailwindcss.com" rel="stylesheet" />
  <!-- Inline styles for delete and plus icons -->
  <style>
    .deleteBookmaker, .deleteOutcome {
      display: none;
      background: transparent;
      border: none;
      cursor: pointer;
      font-size: 1em;
    }
    .relative:hover .deleteBookmaker,
    .relative:hover .deleteOutcome {
      display: inline;
    }
  </style>
  <!-- Chart.js for graphs -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <!-- MathJax for rendering LaTeX -->
  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script id="MathJax-script" async
          src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
  </script>
  <!-- Tailwind CSS Browser Plugin -->
  <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
  <!-- SheetJS for Excel parsing and generation -->
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9261174368196541"
     crossorigin="anonymous"></script>
</head>
<body class="bg-gray-100 text-gray-800">
  <header class="bg-blue-600 text-white p-4 shadow">
    <h1 class="text-3xl text-center font-bold">ADGSTUDIOS | Arbitrage Profitability Calculator</h1>
    <p class="text-center">Calculate your arbitrage opportunities with detailed math, proofs, Excel upload, sample downloads and graphs.</p>
  </header>
  
  <main class="p-4 max-w-6xl mx-auto">
    <!-- ------------------ Simple Two-Way Arbitrage Calculator ------------------ -->
    <section id="calculator" class="bg-white p-6 rounded shadow mt-6">
      <h2 class="text-2xl font-bold mb-4">Two-Way Arbitrage Calculator</h2>
      <form id="calcForm" class="space-y-4">
        <div>
          <label for="oddsA" class="block text-sm font-medium text-gray-700">Odds for Outcome A</label>
          <input id="oddsA" type="number" step="any" placeholder="e.g., 1.70" class="mt-1 block w-full border border-gray-300 rounded p-2" />
        </div>
        <div>
          <label for="oddsB" class="block text-sm font-medium text-gray-700">Odds for Outcome B</label>
          <input id="oddsB" type="number" step="any" placeholder="e.g., 3.32" class="mt-1 block w-full border border-gray-300 rounded p-2" />
        </div>
        <div>
          <label for="currency" class="block text-sm font-medium text-gray-700">Currency</label>
          <select id="currency" class="mt-1 block w-full border border-gray-300 rounded p-2">
            <option value="$">USD ($)</option>
            <option value="€">EUR (€)</option>
            <option value="£">GBP (£)</option>
            <option value="¥">JPY (¥)</option>
            <option value="₹">INR (₹)</option>
          </select>
        </div>
        <div>
          <label for="stakeAmount" class="block text-sm font-medium text-gray-700">Stake Amount</label>
          <input id="stakeAmount" type="number" step="any" placeholder="e.g., 100" class="mt-1 block w-full border border-gray-300 rounded p-2" />
        </div>
        <div class="flex items-center justify-between">
          <button id="calculateBtn" type="button" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">
            Calculate
          </button>
        </div>
      </form>
      <div id="result" class="mt-6 text-center text-lg"></div>
      <section id="graphSection" class="bg-white p-6 rounded shadow mt-6 hidden">
        <h2 class="text-2xl font-bold mb-4">Stake Distribution Graph</h2>
        <canvas id="stakeChart"></canvas>
      </section>
    </section>
    
    <!-- ------------------ Advanced Arbitrage Calculator (Matrix & Multi‑Match) ------------------ -->
    <section id="advancedCalculator" class="bg-white p-6 rounded shadow mt-6">
      <h2 class="text-2xl font-bold mb-4">Advanced Arbitrage Calculator</h2>
      <div class="mb-4">
        <label for="advancedStakeAmount" class="block text-sm font-medium text-gray-700">Stake Amount</label>
        <input id="advancedStakeAmount" type="number" step="any" placeholder="e.g., 100" class="mt-1 block w-full border border-gray-300 rounded p-2" />
      </div>
      <!-- Container for match tables -->
      <div id="advancedMatchContainer"></div>
      <div class="flex space-x-4 mt-4">
        <button id="addMatchBtn" class="bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded">Add Match</button>
        <button id="calcAdvancedBtn" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">Calculate Advanced Arbitrage</button>
      </div>
      <div id="advancedResult" class="mt-6 text-center text-lg"></div>
      <section id="advancedGraphSection" class="mt-6 hidden">
        <h2 class="text-2xl font-bold mb-4">Advanced Stake Distribution Graph</h2>
        <canvas id="advancedChart"></canvas>
      </section>
    </section>
    


    <!-- ------------------ Mathematical Derivations & Proofs ------------------ -->
    <section id="mathSection" class="bg-white p-6 rounded shadow mt-6">
      <h2 class="text-2xl font-bold mb-4">Mathematical Derivations & Proofs</h2>
      <div class="prose">
        <!-- Two-Way Arbitrage Derivation -->
        <p>
          We begin by assuming a total stake \( T \) distributed between two outcomes:
          \[
          x + y = T.
          \]
        </p>
        <p>
          For outcome A with odds \( a \) and outcome B with odds \( b \), the returns are:
          \[
          \text{Return A} = a \cdot x, \quad \text{Return B} = b \cdot y.
          \]
        </p>
        <p>
          Setting the returns equal for an arbitrage opportunity:
          \[
          a \cdot x = b \cdot y = R.
          \]
        </p>
        <p>
          This gives:
          \[
          x = \frac{R}{a}, \quad y = \frac{R}{b}.
          \]
        </p>
        <p>
          Substituting back into the total stake:
          \[
          \frac{R}{a} + \frac{R}{b} = T \quad \Rightarrow \quad R \left(\frac{1}{a} + \frac{1}{b}\right) = T.
          \]
        </p>
        <p>
          Hence, the common return is:
          \[
          R = \frac{T}{\frac{1}{a} + \frac{1}{b}}.
          \]
        </p>
        <p>
          For an arbitrage to be profitable, we require \( R > T \), which simplifies to:
          \[
          \frac{1}{a} + \frac{1}{b} < 1.
          \]
        </p>
        <h3>Lemma (Arbitrage Condition)</h3>
        <p>
          <strong>Lemma:</strong> For any two odds \( a \) and \( b \), if 
          \[
          \frac{1}{a} + \frac{1}{b} < 1,
          \]
          then a two‑way arbitrage opportunity exists.
        </p>
        <h3>Theorem (Profitability Theorem)</h3>
        <p>
          <strong>Theorem:</strong> Given a total stake \( T \) and odds \( a \) and \( b \), the arbitrage profit margin \( P \) is:
          \[
          P = 1 - \left(\frac{1}{a} + \frac{1}{b}\right),
          \]
          and an arbitrage opportunity exists if and only if \( P > 0 \).
        </p>
        <hr>
        <!-- Advanced Matrix Arbitrage Derivation -->
        <p>
          In a market with \( n \) outcomes and \( k \) bookmakers, let the odds provided for outcome \( i \) by bookmaker \( j \) be denoted as \( o_{ij} \). Define the best odds for outcome \( i \) as:
          \[
          o_i^* = \max_{j=1,\dots,k} o_{ij}.
          \]
          An arbitrage opportunity exists if:
          \[
          \sum_{i=1}^{n} \frac{1}{o_i^*} < 1,
          \]
          with profit margin:
          \[
          1 - \sum_{i=1}^{n} \frac{1}{o_i^*}.
          \]
        </p>
        <h3>Advanced Lemma (Best Odds Selection)</h3>
        <p>
          <strong>Lemma:</strong> For a given outcome \( i \) and a set of \( k \) bookmakers, the optimal odds is:
          \[
          o_i^* = \max_{1 \leq j \leq k} o_{ij}.
          \]
        </p>
        <h3>Advanced Theorem (Matrix Arbitrage Theorem)</h3>
        <p>
          <strong>Theorem:</strong> Given a matrix of odds \( \{ o_{ij} \} \) for \( n \) outcomes and \( k \) bookmakers, an arbitrage opportunity exists if:
          \[
          \sum_{i=1}^{n} \frac{1}{\max_{1 \leq j \leq k} o_{ij}} < 1,
          \]
          with profit margin:
          \[
          1 - \sum_{i=1}^{n} \frac{1}{\max_{1 \leq j \leq k} o_{ij}}.
          \]
        </p>
        <hr>
        <!-- Multi-Match (Multi-Dimensional) Arbitrage Derivation -->
        <p>
          For a series of \( k \) independent matches (or games), assume each match \( g \) has \( n_g \) outcomes with best odds \( o_{i}^{*(g)} \) for outcome \( i \) in match \( g \). Consider a combined bet covering every possible outcome combination across the \( k \) matches. The compound odds for a specific combination \( (i_1, i_2, \dots, i_k) \) is:
          \[
          O_{i_1,i_2,\dots,i_k} = \prod_{g=1}^{k} o_{i_g}^{*(g)}.
          \]
        </p>
        <p>
          If a total stake \( T \) is distributed among all \( N = \prod_{g=1}^{k} n_g \) combinations, with each combination receiving a bet \( x_{i_1,i_2,\dots,i_k} \) such that:
          \[
          \sum_{(i_1,\dots,i_k)} x_{i_1,i_2,\dots,i_k} = T,
          \]
          and aiming for a common return \( R \), we set:
          \[
          x_{i_1,i_2,\dots,i_k} = \frac{R}{O_{i_1,i_2,\dots,i_k}}.
          \]
        </p>
        <p>
          Summing over all combinations gives:
          \[
          R \left( \sum_{(i_1,\dots,i_k)} \frac{1}{O_{i_1,i_2,\dots,i_k}} \right) = T.
          \]
        </p>
        <p>
          Thus, the common return is:
          \[
          R = \frac{T}{\sum_{(i_1,i_2,\dots,i_k)} \frac{1}{O_{i_1,i_2,\dots,i_k}}}.
          \]
        </p>
        <p>
          For the arbitrage to be profitable, we require \( R > T \), which implies:
          \[
          \sum_{(i_1,i_2,\dots,i_k)} \frac{1}{O_{i_1,i_2,\dots,i_k}} < 1.
          \]
        </p>
        <p>
          The profit margin for the multi-match arbitrage is then:
          \[
          P = 1 - \sum_{(i_1,i_2,\dots,i_k)} \frac{1}{O_{i_1,i_2,\dots,i_k}}.
          \]
        </p>
        <h3>Multi-Match Arbitrage Theorem</h3>
        <p>
          <strong>Theorem:</strong> For \( k \) independent matches, with each match \( g \) having \( n_g \) outcomes and corresponding best odds \( o_{i}^{*(g)} \), an overall arbitrage opportunity exists if:
          \[
          \sum_{(i_1,i_2,\dots,i_k)} \frac{1}{\prod_{g=1}^{k} o_{i_g}^{*(g)}} < 1.
          \]
          The total arbitrage profit margin is given by:
          \[
          P = 1 - \sum_{(i_1,i_2,\dots,i_k)} \frac{1}{\prod_{g=1}^{k} o_{i_g}^{*(g)}}.
          \]
        </p>
      </div>
    </section>
  </main>
  
  <footer class="bg-gray-800 text-white p-4 mt-6 text-center">    
    <p>&copy; 
      <script>document.write(new Date().getFullYear());</script>
      ADGSTUDIOS | Two Way Arbitrage Calculator. All rights reserved.
    </p>
    <br>
    <div class="flex items-center justify-center">
      <a href="https://clustrmaps.com/site/1c4yx" title="ClustrMaps">
        <img src="//www.clustrmaps.com/map_v2.png?d=z9ePD342k15M77o08Py8Yjgg1UZtvNVmnyhshmg-E1Q&cl=ffffff" />
      </a>
    </div>
  </footer>
  
  <script>
    // ------------------ Simple Two-Way Arbitrage Calculator ------------------
    const oddsAInput = document.getElementById('oddsA');
    const oddsBInput = document.getElementById('oddsB');
    const resultDiv = document.getElementById('result');
    const calculateBtn = document.getElementById('calculateBtn');
    const currencySelect = document.getElementById('currency');
    const graphSection = document.getElementById('graphSection');
    let stakeChart = null;

    calculateBtn.addEventListener('click', () => {
      const a = parseFloat(oddsAInput.value);
      const b = parseFloat(oddsBInput.value);
      const currency = currencySelect.value;
      const totalStake = parseFloat(document.getElementById('stakeAmount').value);

      if (isNaN(a) || isNaN(b) || a <= 0 || b <= 0) {
        resultDiv.textContent = 'Please enter valid positive numbers for both odds.';
        graphSection.classList.add('hidden');
        return;
      }
      
      if (isNaN(totalStake) || totalStake <= 0) {
        resultDiv.textContent = 'Please enter a valid positive stake amount.';
        graphSection.classList.add('hidden');
        return;
      }

      const sumInverse = (1 / a) + (1 / b);
      let outputHTML = '';
      
      if (sumInverse < 1) {
        const profitMargin = 1 - sumInverse;
        outputHTML += `<span class="text-green-600 font-bold">Arbitrage opportunity exists!</span><br>`;
        outputHTML += `Profit Margin: ${(profitMargin * 100).toFixed(2)}%<br>`;
        const stakeA = totalStake / (a * sumInverse);
        const stakeB = totalStake / (b * sumInverse);
        const commonReturn = a * stakeA;
        const totalProfit = commonReturn - totalStake;
        
        let tableHTML = `
          <table class="min-w-full mt-4 border-collapse border border-gray-300">
            <thead>
              <tr>
                <th class="px-4 py-2 border">Outcome</th>
                <th class="px-4 py-2 border">Odds</th>
                <th class="px-4 py-2 border">Stake (${currency})</th>
                <th class="px-4 py-2 border">Return (${currency})</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="px-4 py-2 border">Outcome A</td>
                <td class="px-4 py-2 border">${a.toFixed(2)}</td>
                <td class="px-4 py-2 border">${stakeA.toFixed(2)}</td>
                <td class="px-4 py-2 border">${(a * stakeA).toFixed(2)}</td>
              </tr>
              <tr>
                <td class="px-4 py-2 border">Outcome B</td>
                <td class="px-4 py-2 border">${b.toFixed(2)}</td>
                <td class="px-4 py-2 border">${stakeB.toFixed(2)}</td>
                <td class="px-4 py-2 border">${(b * stakeB).toFixed(2)}</td>
              </tr>
            </tbody>
          </table>
        `;
        
        outputHTML += `<br><strong>Bets Table:</strong><br>` + tableHTML;
        outputHTML += `<br>Total Return: ${currency}${commonReturn.toFixed(2)}<br>`;
        outputHTML += `Total Profit: ${currency}${totalProfit.toFixed(2)}<br>`;
        resultDiv.innerHTML = outputHTML;

        graphSection.classList.remove('hidden');
        const ctx = document.getElementById('stakeChart').getContext('2d');
        if (stakeChart) stakeChart.destroy();
        stakeChart = new Chart(ctx, {
          type: 'bar',
          data: {
            labels: ['Outcome A', 'Outcome B'],
            datasets: [{
              label: 'Stake Distribution',
              data: [stakeA, stakeB],
              backgroundColor: ['rgba(75, 192, 192, 0.6)', 'rgba(255, 159, 64, 0.6)'],
              borderColor: ['rgba(75, 192, 192, 1)', 'rgba(255, 159, 64, 1)'],
              borderWidth: 1
            }]
          },
          options: {
            scales: {
              y: {
                beginAtZero: true,
                title: { display: true, text: `Stake in ${currency}` }
              }
            }
          }
        });
      } else {
        resultDiv.innerHTML = `<span class="text-red-600 font-bold">No arbitrage opportunity.</span>`;
        graphSection.classList.add('hidden');
      }
    });

    // ------------------ Advanced Arbitrage Calculator (Matrix & Multi‑Match) ------------------
    const advancedMatchContainer = document.getElementById('advancedMatchContainer');
    const addMatchBtn = document.getElementById('addMatchBtn');
    const calcAdvancedBtn = document.getElementById('calcAdvancedBtn');
    const advancedResultDiv = document.getElementById('advancedResult');
    const advancedGraphSection = document.getElementById('advancedGraphSection');
    let advancedChart = null;
    let matchCounter = 0;

    function createMatchTable() {
      matchCounter++;
      const matchDiv = document.createElement('div');
      matchDiv.className = "matchTable bg-gray-50 p-4 rounded shadow mt-4";
      matchDiv.id = `match-${matchCounter}`;
      matchDiv.innerHTML = `
        <div class="mb-2 flex items-center justify-between">
          <div>
            <label class="block text-sm font-medium text-gray-700">Match Name</label>
            <input type="text" class="matchNameInput mt-1 block w-full border border-gray-300 rounded p-2" placeholder="Enter match name" value="Match ${matchCounter}" />
          </div>
          <button class="deleteMatchBtn bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded">Delete Match</button>
        </div>
        <div class="flex items-center justify-between">
          <h3 class="text-xl font-semibold">Match ${matchCounter} Matrix</h3>
          <div class="flex space-x-2">
            <button class="addOutcomeBtn bg-green-500 hover:bg-green-700 text-white font-bold py-1 px-3 rounded">Add Outcome</button>
            <button class="addBookmakerBtn bg-green-500 hover:bg-green-700 text-white font-bold py-1 px-3 rounded">Add Bookmaker</button>
          </div>
        </div>
        <div class="overflow-x-auto mt-2">
          <table class="w-full border">
            <thead>
              <tr>
                <th class="px-2 py-1 border">Outcome / Bookmaker</th>
                <th class="px-2 py-1 border relative">
                  <input type="text" value="Bookmaker 1" class="w-full p-1 border"/>
                  <button class="deleteBookmaker absolute top-0 right-0" title="Delete Bookmaker">🗑️</button>
                </th>
                <th class="px-2 py-1 border relative">
                  <input type="text" value="Bookmaker 2" class="w-full p-1 border"/>
                  <button class="deleteBookmaker absolute top-0 right-0" title="Delete Bookmaker">🗑️</button>
                </th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="px-2 py-1 border relative">
                  <input type="text" value="Outcome 1" class="w-full p-1 border"/>
                  <button class="deleteOutcome absolute top-0 right-0" title="Delete Outcome">🗑️</button>
                </td>
                <td class="px-2 py-1 border">
                  <input type="number" step="any" value="1.80" class="w-full p-1 border" placeholder="Odds"/>
                </td>
                <td class="px-2 py-1 border">
                  <input type="number" step="any" value="1.90" class="w-full p-1 border" placeholder="Odds"/>
                </td>
              </tr>
              <tr>
                <td class="px-2 py-1 border relative">
                  <input type="text" value="Outcome 2" class="w-full p-1 border"/>
                  <button class="deleteOutcome absolute top-0 right-0" title="Delete Outcome">🗑️</button>
                </td>
                <td class="px-2 py-1 border">
                  <input type="number" step="any" value="4.50" class="w-full p-1 border" placeholder="Odds"/>
                </td>
                <td class="px-2 py-1 border">
                  <input type="number" step="any" value="4.60" class="w-full p-1 border" placeholder="Odds"/>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      `;
      advancedMatchContainer.appendChild(matchDiv);

      const deleteMatchBtn = matchDiv.querySelector('.deleteMatchBtn');
      deleteMatchBtn.addEventListener('click', () => {
        matchDiv.remove();
      });

      const outcomeDeleteButtons = matchDiv.querySelectorAll('.deleteOutcome');
      outcomeDeleteButtons.forEach(btn => {
        btn.addEventListener('click', (e) => {
          e.stopPropagation();
          const row = btn.closest('tr');
          row.remove();
        });
      });

      const bookmakerDeleteButtons = matchDiv.querySelectorAll('.deleteBookmaker');
      bookmakerDeleteButtons.forEach(btn => {
        btn.addEventListener('click', (e) => {
          e.stopPropagation();
          const th = btn.closest('th');
          const table = btn.closest('table');
          const index = Array.from(th.parentElement.children).indexOf(th);
          th.remove();
          table.querySelectorAll('tbody tr').forEach(row => {
            const cells = row.querySelectorAll('td');
            if(cells[index]) cells[index].remove();
          });
        });
      });

      const addOutcomeBtn = matchDiv.querySelector('.addOutcomeBtn');
      addOutcomeBtn.addEventListener('click', () => {
        const table = matchDiv.querySelector('table');
        const tbody = table.querySelector('tbody');
        const newRow = document.createElement('tr');
        newRow.innerHTML = `
          <td class="px-2 py-1 border relative">
            <input type="text" value="Outcome" class="w-full p-1 border"/>
            <button class="deleteOutcome absolute top-0 right-0" title="Delete Outcome">🗑️</button>
          </td>
        `;
        const headerCount = table.querySelectorAll('thead tr th').length;
        for (let i = 1; i < headerCount; i++) {
          const cell = document.createElement('td');
          cell.className = 'px-2 py-1 border';
          cell.innerHTML = '<input type="number" step="any" placeholder="Odds" class="w-full p-1 border"/>';
          newRow.appendChild(cell);
        }
        tbody.appendChild(newRow);
        const newDeleteBtn = newRow.querySelector('.deleteOutcome');
        newDeleteBtn.addEventListener('click', (e) => {
          e.stopPropagation();
          newRow.remove();
        });
      });

      const addBookmakerBtn = matchDiv.querySelector('.addBookmakerBtn');
      addBookmakerBtn.addEventListener('click', () => {
        const table = matchDiv.querySelector('table');
        const theadRow = table.querySelector('thead tr');
        const newTh = document.createElement('th');
        newTh.className = 'px-2 py-1 border relative';
        newTh.innerHTML = `
          <input type="text" value="Bookmaker" class="w-full p-1 border"/>
          <button class="deleteBookmaker absolute top-0 right-0" title="Delete Bookmaker">🗑️</button>
        `;
        theadRow.appendChild(newTh);
        table.querySelectorAll('tbody tr').forEach(row => {
          const newTd = document.createElement('td');
          newTd.className = 'px-2 py-1 border';
          newTd.innerHTML = '<input type="number" step="any" placeholder="Odds" class="w-full p-1 border"/>';
          row.appendChild(newTd);
        });
        const newDeleteBtn = newTh.querySelector('.deleteBookmaker');
        newDeleteBtn.addEventListener('click', (e) => {
          e.stopPropagation();
          const index = Array.from(newTh.parentElement.children).indexOf(newTh);
          newTh.remove();
          table.querySelectorAll('tbody tr').forEach(row => {
            const cells = row.querySelectorAll('td');
            if(cells[index]) cells[index].remove();
          });
        });
      });
    }

    createMatchTable();
    addMatchBtn.addEventListener('click', createMatchTable);

    function cartesianProduct(arrays) {
      return arrays.reduce((acc, curr) => {
        let result = [];
        acc.forEach(a => {
          curr.forEach(b => {
            result.push(a.concat(b));
          });
        });
        return result;
      }, [[]]);
    }

    calcAdvancedBtn.addEventListener('click', () => {
      const totalStake = parseFloat(document.getElementById('advancedStakeAmount').value);
      if (isNaN(totalStake) || totalStake <= 0) {
        advancedResultDiv.innerHTML = 'Please enter a valid positive stake amount.';
        advancedGraphSection.classList.add('hidden');
        return;
      }

      const matchTables = document.querySelectorAll('.matchTable');
      let bestOddsArrays = [];
      let singleMatchResults = "";
      let multiMatch = matchTables.length > 1;

      matchTables.forEach(matchDiv => {
        const matchName = matchDiv.querySelector('.matchNameInput').value || "Unnamed Match";
        const table = matchDiv.querySelector('table');
        const tbodyRows = table.querySelectorAll('tbody tr');
        let bestOdds = [];
        tbodyRows.forEach(row => {
          const cells = row.querySelectorAll('td');
          const outcomeName = cells[0].querySelector('input').value;
          let bestValue = -Infinity, bestBookmaker = "";
          for (let i = 1; i < cells.length; i++) {
            const odd = parseFloat(cells[i].querySelector('input').value);
            if (!isNaN(odd) && odd > bestValue) {
              bestValue = odd;
              const headerInput = table.querySelector(`thead tr th:nth-child(${i+1}) input`);
              bestBookmaker = headerInput ? headerInput.value : `Bookmaker ${i}`;
            }
          }
          if (bestValue > 0) {
            bestOdds.push({
              odd: bestValue,
              outcomeName: outcomeName,
              bookmaker: bestBookmaker,
              matchName: matchName
            });
          }
        });
        bestOddsArrays.push(bestOdds);

        // Single-match arbitrage (matrix) case with detailed table
        if (!multiMatch) {
          const sumReciprocals = bestOdds.reduce((sum, obj) => sum + (1/obj.odd), 0);
          if (sumReciprocals < 1) {
            const profitMargin = 1 - sumReciprocals;
            singleMatchResults += `<span class="text-green-600 font-bold">Arbitrage opportunity exists in ${matchName}!</span><br>`;
            singleMatchResults += `Profit Margin: ${(profitMargin * 100).toFixed(2)}%<br>`;
            singleMatchResults += `<strong>Details:</strong><br>`;
            const commonReturn = totalStake / sumReciprocals;
            const profit = commonReturn - totalStake;
            let matchTableHTML = `
              <table class="min-w-full mt-4 border-collapse border border-gray-300">
                <thead>
                  <tr>
                    <th class="px-4 py-2 border">Outcome</th>
                    <th class="px-4 py-2 border">Odds</th>
                    <th class="px-4 py-2 border">Stake</th>
                    <th class="px-4 py-2 border">Profit</th>
                    <th class="px-4 py-2 border">Stake + Profit</th>
                  </tr>
                </thead>
                <tbody>
            `;
            bestOdds.forEach((obj, index) => {
              const stake = totalStake / (obj.odd * sumReciprocals);
              matchTableHTML += `<tr>
                <td class="px-4 py-2 border">${obj.outcomeName} (Bookmaker: ${obj.bookmaker})</td>
                <td class="px-4 py-2 border">${obj.odd.toFixed(2)}</td>
                <td class="px-4 py-2 border">${stake.toFixed(2)}</td>
                <td class="px-4 py-2 border">${profit.toFixed(2)}</td>
                <td class="px-4 py-2 border">${commonReturn.toFixed(2)}</td>
              </tr>`;
            });
            matchTableHTML += `</tbody></table>`;
            singleMatchResults += matchTableHTML + `<br>`;
          } else {
            singleMatchResults += `<span class="text-red-600 font-bold">No arbitrage opportunity in ${matchName}.</span><br><br>`;
          }
        }
      });

      if (!multiMatch) {
        advancedResultDiv.innerHTML = singleMatchResults;
        advancedGraphSection.classList.add('hidden');
        return;
      }

      // Multi-match arbitrage computation (remains unchanged)
      const combinations = cartesianProduct(bestOddsArrays);
      let comboData = combinations.map(combo => {
        const combinedOdd = combo.reduce((prod, obj) => prod * obj.odd, 1);
        return {combo, combinedOdd};
      });
      const sumReciprocals = comboData.reduce((sum, obj) => sum + (1 / obj.combinedOdd), 0);
      let resultHTML = "";
      if (sumReciprocals < 1) {
        const profitMargin = 1 - sumReciprocals;
        resultHTML += `<span class="text-green-600 font-bold">Multi-match arbitrage opportunity exists!</span><br>`;
        resultHTML += `Profit Margin: ${(profitMargin * 100).toFixed(2)}%<br><br>`;
        const commonReturn = totalStake / sumReciprocals;
        const totalProfit = commonReturn - totalStake;
        
        let tableHTML = `
          <table class="min-w-full mt-4 border-collapse border border-gray-300">
            <thead>
              <tr>
                <th class="px-4 py-2 border">Combination</th>
                <th class="px-4 py-2 border">Outcome Details</th>
                <th class="px-4 py-2 border">Combined Odd</th>
                <th class="px-4 py-2 border">Stake</th>
                <th class="px-4 py-2 border">Return</th>
                <th class="px-4 py-2 border">Profit</th>
              </tr>
            </thead>
            <tbody>
        `;
        comboData.forEach((obj, index) => {
          const stake = totalStake / (obj.combinedOdd * sumReciprocals);
          obj.stake = stake;
          const label = obj.combo.map(detail => {
            return `${detail.matchName} – ${detail.outcomeName} (Bookmaker: ${detail.bookmaker}, Odd: ${detail.odd})`;
          }).join(' | ');
          tableHTML += `<tr>
            <td class="px-4 py-2 border">Combo ${index+1}</td>
            <td class="px-4 py-2 border">${label}</td>
            <td class="px-4 py-2 border">${obj.combinedOdd.toFixed(2)}</td>
            <td class="px-4 py-2 border">${stake.toFixed(2)}</td>
            <td class="px-4 py-2 border">${(obj.combinedOdd * stake).toFixed(2)}</td>
            <td class="px-4 py-2 border">${(commonReturn - totalStake).toFixed(2)}</td>
          </tr>`;
        });
        tableHTML += `</tbody></table>`;
        resultHTML += `<strong>Stake Distribution for Each Outcome Combination:</strong><br>` + tableHTML;
        resultHTML += `<br>Total Return: ${commonReturn.toFixed(2)}<br>`;
        resultHTML += `Total Profit: ${totalProfit.toFixed(2)}<br>`;
        advancedResultDiv.innerHTML = resultHTML;
        advancedGraphSection.classList.remove('hidden');
        const ctxAdv = document.getElementById('advancedChart').getContext('2d');
        if (advancedChart) advancedChart.destroy();
        advancedChart = new Chart(ctxAdv, {
          type: 'bar',
          data: {
            labels: comboData.map((obj, index) => `Combo ${index+1}`),
            datasets: [{
              label: 'Stake Distribution',
              data: comboData.map(obj => obj.stake),
              backgroundColor: 'rgba(153, 102, 255, 0.6)',
              borderColor: 'rgba(153, 102, 255, 1)',
              borderWidth: 1
            }]
          },
          options: {
            scales: {
              y: {
                beginAtZero: true,
                title: { display: true, text: 'Stake' }
              }
            }
          }
        });
      } else {
        advancedResultDiv.innerHTML = `<span class="text-red-600 font-bold">No multi-match arbitrage opportunity.</span>`;
        advancedGraphSection.classList.add('hidden');
      }
    });
  </script>
</body>
</html>
